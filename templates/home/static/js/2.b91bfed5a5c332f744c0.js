webpackJsonp([2],{"15wu":function(t,a){},Ka16:function(t,a,s){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var c,i=s("mvHQ"),e=s.n(i),n=s("kOVN"),o=s("CaOM"),l=s("mtWM"),r=s.n(l),u=s("P9l9"),_=s("Au9i"),p=s("POuD"),m={afterOpen:function(){c=document.scrollingElement.scrollTop||document.body.scrollTop,document.body.classList.add("scroll"),document.body.style.top=-c+"px"},beforeClose:function(){document.body.classList.remove("scroll"),document.scrollingElement.scrollTop=c,document.body.scrollTop=c}},h={data:function(){return{cart_list:null,page_info:{page_num:1,page_size:5},isScroll:!0,total_count:0,total_number:0,bottom_show:!1,show_sku:!1,select_value:null,canums:1,product_info:null,sku_pb_index:null,sku_pr_index:null,allRadio:!1,total_money:0,isManage:!1}},components:{sku:n.a,bottomLine:p.a},mounted:function(){this.getCart()},methods:{changeRoute:function(t,a){this.$router.push({path:"/product/detail",query:{prid:a.prid}})},payOrder:function(t){for(var a=[],s=0;s<this.cart_list.length;s++)for(var c=0;c<this.cart_list[s].cart.length;c++)this.cart_list[s].cart[c].active&&(a[s]?a[s].cart.push(this.cart_list[s].cart[c]):a[s]={cart:[this.cart_list[s].cart[c]],pb:this.cart_list[s].pb});a.length>0?this.$router.push({path:"/submitOrder",query:{product:e()(a)}}):Object(_.Toast)("请先选择商品")},getCart:function(){var t=this;r.a.get(u.a.cart_list,{params:{token:localStorage.getItem("token"),page_size:this.page_info.page_size,page_num:this.page_info.page_num}}).then(function(a){if(200==a.data.status){if(!(a.data.data.length>0))return t.cart_list=[],t.page_info.page_num=1,t.total_count=0,t.total_number=0,!1;t.page_info.page_num>1?t.cart_list=t.cart_list.concat(a.data.data):t.cart_list=a.data.data,t.page_info.page_num=t.page_info.page_num+1;for(var s=[].concat(t.cart_list),c=0;c<s.length;c++){s[c].active=!1;for(var i=0;i<s[c].cart.length;i++)s[c].cart[i].active=!1}t.cart_list=[].concat(s),t.isScroll=!0,t.total_count=a.data.total_count,t.total_number=a.data.product_num||0}})},touchMove:function(t){var a=o.a.getScrollTop(),s=o.a.getScrollHeight();a+o.a.getClientHeight()>=s-10&&this.isScroll&&(this.isScroll=!1,this.cart_list.length==this.total_count?this.bottom_show=!0:this.getCart())},skuSelect:function(t,a,s){this.sku_pb_index=t,this.sku_pr_index=a,this.select_value=s.sku,this.product_info=s.product,this.canums=s.canums,this.show_sku=!0},changeModal:function(t,a){this[t]=a,a?m.afterOpen():m.beforeClose()},sureClick:function(t,a){this.show_sku=!1,this.updateCart(t,a)},updateCart:function(t,a,s,c){var i=this;r.a.post(u.a.cart_update+"?token="+localStorage.getItem("token"),{caid:c||this.cart_list[this.sku_pb_index].cart[this.sku_pr_index].caid,skuid:t.skuid,canums:a}).then(function(c){if(200==c.data.status)if(s);else{var e=[].concat(i.cart_list);e[i.sku_pb_index].cart[i.sku_pr_index].canums=a,e[i.sku_pb_index].cart[i.sku_pr_index].sku=t,i.cart_list=[].concat(e)}})},dealMoney:function(){for(var t=[].concat(this.cart_list),a=0,s=0;s<t.length;s++)for(var c=0;c<t[s].cart.length;c++)t[s].cart[c].active&&(a+=Number(t[s].cart[c].sku.skuprice)*t[s].cart[c].canums);this.total_money=a},radioClick:function(t,a,s){var c=[].concat(this.cart_list);switch(t){case"all":this.allRadio=!this.allRadio;for(var i=0;i<c.length;i++){c[i].active=this.allRadio;for(var e=0;e<c[i].cart.length;e++)c[i].cart[e].active=this.allRadio}this.cart_list=[].concat(c);break;case"store":c[a].active=!c[a].active;for(var n=0;n<c[a].cart.length;n++)c[a].cart[n].active=c[a].active;break;case"product":c[a].cart[s].active=!c[a].cart[s].active;for(var o=0,l=0;l<c[a].cart.length;l++)c[a].cart[s].active==c[a].cart[l].active&&(o+=1);c[a].cart[s].active?o==c[a].cart.length&&(c[a].active=c[a].cart[s].active):o>0&&o<c[a].cart.length&&(this.allRadio=!1,c[a].active=!1)}if("all"!=t){for(var r=0,u=0;u<c.length;u++)c[u].active==c[a].active&&(r+=1);r==c.length&&(this.allRadio=c[a].active),this.cart_list=[].concat(c)}this.dealMoney()},changeNum:function(t,a,s){if(-1==t&&1==this.cart_list[a].cart[s].canums)return!1;this.cart_list[a].cart[s].canums=this.cart_list[a].cart[s].canums+t,this.updateCart(this.cart_list[a].cart[s].sku,this.cart_list[a].cart[s].canums,"num",this.cart_list[a].cart[s].caid),this.dealMoney()},DestroyCart:function(){for(var t=this,a=[],s=0;s<this.cart_list.length;s++)for(var c=0;c<this.cart_list[s].cart.length;c++)this.cart_list[s].cart[c].active&&a.push(this.cart_list[s].cart[c].caid);r.a.post(u.a.cart_destroy+"?token="+localStorage.getItem("token"),{caids:a}).then(function(a){200==a.data.status&&(t.page_info.page_num=1,t.total_count=1,t.getCart())})},changeManage:function(){this.isManage=!this.isManage}},created:function(){}},v={render:function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"m-shop"},[t._m(0),t._v(" "),s("div",{staticClass:"m-shop-content",on:{touchmove:function(a){return a.stopPropagation(),t.touchMove(a)}}},[s("h3",{staticClass:"m-shop-title"},[s("span",{staticClass:"m-title"},[t._v("购物车")]),t._v(" "),t.isManage?t._e():s("span",{staticClass:"m-ft-26",on:{click:t.changeManage}},[t._v("管理")]),t._v(" "),t.isManage?s("span",{staticClass:"m-ft-26",on:{click:t.changeManage}},[t._v("完成")]):t._e()]),t._v(" "),s("p",{staticClass:"m-p"},[t._v("共"+t._s(t.total_number)+"件商品")]),t._v(" "),t._l(t.cart_list,function(a,c){return[s("div",{staticClass:"m-shop-one"},[s("div",{staticClass:"m-shop-store-name"},[s("span",{staticClass:"m-icon-radio",class:a.active?"active":"",on:{click:function(a){t.radioClick("store",c)}}}),t._v(" "),s("span",[t._v(t._s(a.pb.pbname))]),t._v(" "),s("span",{staticClass:"m-icon-more"})]),t._v(" "),t._l(a.cart,function(a,i){return[s("div",{staticClass:"m-shop-product "},[s("span",{staticClass:"m-icon-radio",class:a.active?"active":"",on:{click:function(a){t.radioClick("product",c,i)}}}),t._v(" "),s("div",{staticClass:"m-product-info",on:{click:function(s){t.changeRoute("praoduct",a)}}},[s("img",{staticClass:"m-product-img",attrs:{src:a.sku.skupic,alt:""}}),t._v(" "),s("div",{staticClass:"m-text-info"},[s("h3",[t._v(t._s(a.product.prtitle))]),t._v(" "),s("p",{staticClass:"m-product-sku-select-p"},[s("span",{staticClass:"m-product-sku-select",on:{click:function(s){s.stopPropagation(),t.skuSelect(c,i,a)}}},[t._l(a.sku.skuattritedetail,function(c,i){return[s("span",[t._v(t._s(c))]),t._v(" "),i<a.sku.skuattritedetail.length-1?s("span",[t._v("；")]):t._e()]}),t._v(" "),s("span",{staticClass:"m-sku-more"})],2)]),t._v(" "),s("div",{staticClass:"m-sku-num"},[s("span",{staticClass:"m-red"},[t._v("￥"+t._s(t._f("money")(a.sku.skuprice)))]),t._v(" "),s("div",{staticClass:"m-num"},[s("span",{staticClass:"m-icon-cut",on:{click:function(a){a.stopPropagation(),t.changeNum(-1,c,i)}}}),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:a.canums,expression:"item.canums"}],staticClass:"m-num-input",attrs:{type:"number"},domProps:{value:a.canums},on:{input:function(s){s.target.composing||t.$set(a,"canums",s.target.value)}}}),t._v(" "),s("span",{staticClass:"m-icon-add",on:{click:function(a){a.stopPropagation(),t.changeNum(1,c,i)}}})])])])])])]})],2)]}),t._v(" "),t.show_sku?s("sku",{attrs:{now_select:t.select_value,now_num:t.canums,product:t.product_info},on:{changeModal:t.changeModal,sureClick:t.sureClick}}):t._e()],2),t._v(" "),t.bottom_show?s("bottom-line"):t._e(),t._v(" "),s("div",{staticClass:"m-shop-foot"},[s("span",{staticClass:"m-icon-radio",class:t.allRadio?"active":"",on:{click:function(a){t.radioClick("all")}}}),t._v(" "),t.isManage?s("div",[s("span",{staticClass:"m-shop-btn",on:{click:function(a){return a.stopPropagation(),t.DestroyCart(a)}}},[t._v("删除")])]):s("div",[s("span",[t._v("合计")]),t._v(" "),s("span",{staticClass:"m-red"},[t._v("￥"+t._s(t._f("money")(t.total_money)))]),t._v(" "),s("span",{staticClass:"m-shop-btn",on:{click:function(a){return a.stopPropagation(),t.payOrder(a)}}},[t._v("结算")])])])],1)},staticRenderFns:[function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"m-shop-bg"},[a("span",{staticClass:"m-icon-bg"})])}]};var d=s("VU/8")(h,v,!1,function(t){s("hE2d")},"data-v-533c8f9e",null);a.default=d.exports},hE2d:function(t,a){},kOVN:function(t,a,s){"use strict";var c=s("mvHQ"),i=s.n(c),e={data:function(){return{select:[],select_value:null,num:1}},props:{product:{type:Object,default:null},now_select:{type:Object,default:null},now_num:{type:Number,default:1}},mounted:function(){this.now_select&&(this.select_value=this.now_select,this.select=this.select_value.skuattritedetail,this.num=this.now_num)},methods:{changeModal:function(t,a){this.$emit("changeModal",t,a)},changeNum:function(t){if(-1==t&&1==this.num)return!1;this.num=this.num+t},skuSelect:function(t,a){var s=[].concat(this.select);s[t]=a,this.select=[].concat(s);var c=-1;if(this.select.length===this.product.skuvalue.length)for(var e=0;e<this.product.skus.length;e++)i()(this.product.skus[e].skuattritedetail)===i()(this.select)&&this.product.skus[e].skuattritedetail.length==this.select.length&&(this.select_value=this.product.skus[e],c+=1);-1==c&&(this.select_value=null)},sureClick:function(){this.$emit("sureClick",this.select_value,this.num)}}},n={render:function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"m-sku"},[s("div",{staticClass:"m-sku-state"},[s("span",{staticClass:"m-icon-close",on:{click:function(a){t.changeModal("show_sku",!1)}}}),t._v(" "),s("div",{staticClass:"m-sku-content"},[s("div",{staticClass:"m-sku-img-box m-center"},[t.select_value?s("img",{attrs:{src:t.select_value.skupic,alt:""}}):s("img",{attrs:{src:t.product.prmainpic,alt:""}})]),t._v(" "),s("div",{staticClass:"m-center"},[t.select_value?s("span",{staticClass:"m-red"},[t._v("￥"+t._s(t.select_value.skuprice))]):s("span",{staticClass:"m-red"},[t._v("￥"+t._s(t.product.prprice))])]),t._v(" "),s("div",{staticClass:"m-scroll"},[s("ul",{staticClass:"m-sku-box"},t._l(t.product.skuvalue,function(a,c){return s("li",[s("p",[t._v(t._s(a.name))]),t._v(" "),s("ul",{staticClass:"m-sku-ul"},t._l(a.value,function(a){return s("li",{class:a==t.select[c]?"active":"",on:{click:function(s){s.stopPropagation(),t.skuSelect(c,a)}}},[t._v(t._s(a))])}))])})),t._v(" "),s("div",{staticClass:"m-sku-num"},[s("span",[t._v("购买数量")]),t._v(" "),s("div",{staticClass:"m-num"},[s("span",{staticClass:"m-icon-cut",on:{click:function(a){a.stopPropagation(),t.changeNum(-1)}}}),t._v(" "),s("input",{directives:[{name:"model",rawName:"v-model",value:t.num,expression:"num"}],staticClass:"m-num-input",attrs:{type:"number",min:"1"},domProps:{value:t.num},on:{input:function(a){a.target.composing||(t.num=a.target.value)}}}),t._v(" "),s("span",{staticClass:"m-icon-add",on:{click:function(a){a.stopPropagation(),t.changeNum(1)}}})])])]),t._v(" "),s("div",{staticClass:"m-sku-btn"},[t.select_value&&t.select_value.skustock>0?s("span",{staticClass:"active",on:{click:function(a){return a.stopPropagation(),t.sureClick(a)}}},[t._v("确 定")]):s("span",[t._v("确定")])])])])])},staticRenderFns:[]};var o=s("VU/8")(e,n,!1,function(t){s("15wu")},"data-v-26cf458c",null);a.a=o.exports}});
//# sourceMappingURL=2.b91bfed5a5c332f744c0.js.map